<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="750" height="580" viewBox="-0.5 -0.5 750 580">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
    <marker id="arrowhead-return" markerWidth="10" markerHeight="7" refX="1" refY="3.5" orient="auto">
      <polygon points="10 0, 0 3.5, 10 7" fill="#666"/>
    </marker>
  </defs>
  <g>
    <!-- Participant boxes -->
    <rect x="30" y="20" width="80" height="40" rx="4" ry="4" fill="#e8eaf6" stroke="#3f51b5" stroke-width="2"/>
    <text x="70" y="45" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold" fill="#333">Client</text>

    <rect x="140" y="20" width="100" height="40" rx="4" ry="4" fill="#e3f2fd" stroke="#1976d2" stroke-width="2"/>
    <text x="190" y="38" text-anchor="middle" font-family="Arial" font-size="11" font-weight="bold" fill="#333">Engine</text>
    <text x="190" y="52" text-anchor="middle" font-family="Arial" font-size="9" fill="#666">evaluate_impact()</text>

    <rect x="270" y="20" width="100" height="40" rx="4" ry="4" fill="#e8f5e9" stroke="#388e3c" stroke-width="2"/>
    <text x="320" y="38" text-anchor="middle" font-family="Arial" font-size="11" font-weight="bold" fill="#333">MM</text>
    <text x="320" y="52" text-anchor="middle" font-family="Arial" font-size="9" fill="#666">MetricsManager</text>

    <rect x="400" y="20" width="100" height="40" rx="4" ry="4" fill="#c8e6c9" stroke="#388e3c" stroke-width="2"/>
    <text x="450" y="38" text-anchor="middle" font-family="Arial" font-size="11" font-weight="bold" fill="#333">Adapter</text>
    <text x="450" y="52" text-anchor="middle" font-family="Arial" font-size="9" fill="#666">CatalogSimulator</text>

    <rect x="530" y="20" width="100" height="40" rx="4" ry="4" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2"/>
    <text x="580" y="38" text-anchor="middle" font-family="Arial" font-size="11" font-weight="bold" fill="#333">MO</text>
    <text x="580" y="52" text-anchor="middle" font-family="Arial" font-size="9" fill="#666">ModelsManager</text>

    <rect x="660" y="20" width="80" height="40" rx="4" ry="4" fill="#e1bee7" stroke="#7b1fa2" stroke-width="2"/>
    <text x="700" y="38" text-anchor="middle" font-family="Arial" font-size="11" font-weight="bold" fill="#333">Model</text>
    <text x="700" y="52" text-anchor="middle" font-family="Arial" font-size="9" fill="#666">ITS</text>

    <!-- Lifelines -->
    <line x1="70" y1="60" x2="70" y2="560" stroke="#999" stroke-width="1" stroke-dasharray="5,5"/>
    <line x1="190" y1="60" x2="190" y2="560" stroke="#999" stroke-width="1" stroke-dasharray="5,5"/>
    <line x1="320" y1="60" x2="320" y2="560" stroke="#999" stroke-width="1" stroke-dasharray="5,5"/>
    <line x1="450" y1="60" x2="450" y2="560" stroke="#999" stroke-width="1" stroke-dasharray="5,5"/>
    <line x1="580" y1="60" x2="580" y2="560" stroke="#999" stroke-width="1" stroke-dasharray="5,5"/>
    <line x1="700" y1="60" x2="700" y2="560" stroke="#999" stroke-width="1" stroke-dasharray="5,5"/>

    <!-- Messages -->
    <!-- 1. Client to Engine: config_path, storage_url -->
    <line x1="70" y1="90" x2="190" y2="90" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
    <text x="130" y="85" text-anchor="middle" font-family="Arial" font-size="10" fill="#333">config_path, storage_url</text>

    <!-- 2. Engine to MM: create_metrics_manager(config) -->
    <line x1="190" y1="130" x2="320" y2="130" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
    <text x="255" y="125" text-anchor="middle" font-family="Arial" font-size="10" fill="#333">create_metrics_manager(config)</text>

    <!-- 3. MM to Adapter: connect(config) -->
    <line x1="320" y1="170" x2="450" y2="170" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
    <text x="385" y="165" text-anchor="middle" font-family="Arial" font-size="10" fill="#333">connect(config)</text>

    <!-- 4. Engine to MM: retrieve_metrics(products) -->
    <line x1="190" y1="210" x2="320" y2="210" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
    <text x="255" y="205" text-anchor="middle" font-family="Arial" font-size="10" fill="#333">retrieve_metrics(products)</text>

    <!-- 5. MM to Adapter: retrieve_business_metrics() -->
    <line x1="320" y1="250" x2="450" y2="250" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
    <text x="385" y="245" text-anchor="middle" font-family="Arial" font-size="10" fill="#333">retrieve_business_metrics()</text>

    <!-- 6. Adapter to MM: standardized DataFrame -->
    <line x1="450" y1="290" x2="320" y2="290" stroke="#333" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#arrowhead-return)"/>
    <text x="385" y="285" text-anchor="middle" font-family="Arial" font-size="10" fill="#333">standardized DataFrame</text>

    <!-- 7. MM to Engine: business_metrics -->
    <line x1="320" y1="330" x2="190" y2="330" stroke="#333" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#arrowhead-return)"/>
    <text x="255" y="325" text-anchor="middle" font-family="Arial" font-size="10" fill="#333">business_metrics</text>

    <!-- 8. Engine self: apply_transform() -->
    <rect x="195" y="355" width="30" height="25" fill="#e3f2fd" stroke="#1976d2"/>
    <text x="250" y="372" text-anchor="start" font-family="Arial" font-size="10" fill="#333">apply_transform()</text>

    <!-- 9. Engine to MO: create_models_manager(config) -->
    <line x1="190" y1="410" x2="580" y2="410" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
    <text x="385" y="405" text-anchor="middle" font-family="Arial" font-size="10" fill="#333">create_models_manager(config)</text>

    <!-- 10. MO to Model: connect(config) -->
    <line x1="580" y1="440" x2="700" y2="440" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
    <text x="640" y="435" text-anchor="middle" font-family="Arial" font-size="10" fill="#333">connect(config)</text>

    <!-- 11. Engine to MO: fit_model(metrics) -->
    <line x1="190" y1="470" x2="580" y2="470" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
    <text x="385" y="465" text-anchor="middle" font-family="Arial" font-size="10" fill="#333">fit_model(metrics)</text>

    <!-- 12. Model to MO: results -->
    <line x1="700" y1="500" x2="580" y2="500" stroke="#333" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#arrowhead-return)"/>
    <text x="640" y="495" text-anchor="middle" font-family="Arial" font-size="10" fill="#333">results</text>

    <!-- 13. MO to Engine: model_results -->
    <line x1="580" y1="530" x2="190" y2="530" stroke="#333" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#arrowhead-return)"/>
    <text x="385" y="525" text-anchor="middle" font-family="Arial" font-size="10" fill="#333">model_results</text>

    <!-- 14. Engine to Client: results_path -->
    <line x1="190" y1="555" x2="70" y2="555" stroke="#333" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#arrowhead-return)"/>
    <text x="130" y="550" text-anchor="middle" font-family="Arial" font-size="10" fill="#333">results_path</text>
  </g>
</svg>
